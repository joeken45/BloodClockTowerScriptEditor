<Window x:Class="BloodClockTowerScriptEditor.Views.CreateCustomRoleDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:BloodClockTowerScriptEditor.Converters"
        Title="新增自訂角色" 
        Height="700" 
        Width="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize">

    <Window.Resources>
        <converters:TeamTypeConverter x:Key="TeamTypeConverter"/>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 表單區 -->
        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="20">

                <!-- 標題 -->
                <TextBlock Text="角色編輯" 
                           FontSize="20" 
                           FontWeight="Bold" 
                           Margin="0,0,0,8"/>
                <Border BorderBrush="#DDD" BorderThickness="0,0,0,1" Margin="0,0,0,12"/>

                <!-- 第一行: 角色 ID + 角色名稱 -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <DockPanel Grid.Column="0">
                        <TextBlock Text="角色 ID *" FontWeight="SemiBold" DockPanel.Dock="Left" 
                                   VerticalAlignment="Center" Margin="0,0,8,0" Width="80"/>
                        <TextBox x:Name="txtId" 
                                 Padding="6,4" 
                                 BorderBrush="#CCC" 
                                 BorderThickness="1" 
                                 VerticalAlignment="Center"
                                 TextChanged="ValidateForm"/>
                    </DockPanel>

                    <DockPanel Grid.Column="2">
                        <TextBlock Text="角色名稱 *" FontWeight="SemiBold" DockPanel.Dock="Left" 
                                   VerticalAlignment="Center" Margin="0,0,8,0" Width="80"/>
                        <TextBox x:Name="txtName" 
                                 Padding="6,4" 
                                 BorderBrush="#CCC" 
                                 BorderThickness="1" 
                                 VerticalAlignment="Center"
                                 TextChanged="ValidateForm"/>
                    </DockPanel>
                </Grid>

                <!-- 第二行: 角色類型 + 英文名稱 -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <DockPanel Grid.Column="0">
                        <TextBlock Text="角色類型 *" FontWeight="SemiBold" DockPanel.Dock="Left" 
                                   VerticalAlignment="Center" Margin="0,0,8,0" Width="80"/>
                        <ComboBox x:Name="cmbTeam" 
                                  Padding="6,4" 
                                  BorderBrush="#CCC" 
                                  BorderThickness="1" 
                                  VerticalAlignment="Center"
                                  SelectedIndex="0"
                                  SelectionChanged="ValidateForm">
                            <ComboBoxItem Content="鎮民" Tag="townsfolk"/>
                            <ComboBoxItem Content="外來者" Tag="outsider"/>
                            <ComboBoxItem Content="爪牙" Tag="minion"/>
                            <ComboBoxItem Content="惡魔" Tag="demon"/>
                            <ComboBoxItem Content="旅行者" Tag="traveler"/>
                            <ComboBoxItem Content="傳奇" Tag="fabled"/>
                            <ComboBoxItem Content="奇遇" Tag="loric"/>
                        </ComboBox>
                    </DockPanel>

                </Grid>

                <Border BorderBrush="#DDD" BorderThickness="0,0,0,1" Margin="0,8"/>

                <!-- 第三行: 圖片 URL + 預覽 -->
                <Grid Margin="0,8,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="50"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="圖片 URL" 
                               FontWeight="SemiBold" 
                               VerticalAlignment="Center"/>

                    <TextBox Grid.Column="2" 
                             x:Name="txtImage" 
                             Padding="6,4" 
                             BorderBrush="#CCC" 
                             BorderThickness="1" 
                             VerticalAlignment="Center"
                             TextChanged="ImageUrl_TextChanged"/>

                    <Border Grid.Column="4" 
                            Width="50" 
                            Height="50" 
                            BorderBrush="#CCC" 
                            BorderThickness="1"
                            Background="#F9F9F9">
                        <Image x:Name="imgPreview" 
                               Stretch="Uniform"/>
                    </Border>
                </Grid>

                <Border BorderBrush="#DDD" BorderThickness="0,0,0,1" Margin="0,8"/>

                <!-- 能力描述 -->
                <DockPanel Margin="0,8,0,8">
                    <TextBlock Text="能力 *" 
                               FontWeight="SemiBold" 
                               DockPanel.Dock="Left" 
                               VerticalAlignment="Top" 
                               Margin="0,4,8,0" 
                               Width="80"/>
                    <TextBox x:Name="txtAbility" 
                             TextWrapping="Wrap" 
                             AcceptsReturn="True" 
                             Height="80"
                             Padding="6,4" 
                             BorderBrush="#CCC" 
                             BorderThickness="1" 
                             FontSize="11" 
                             VerticalScrollBarVisibility="Auto"
                             TextChanged="ValidateForm"/>
                </DockPanel>

                <Border BorderBrush="#DDD" BorderThickness="0,0,0,1" Margin="0,8"/>

                <!-- 所屬劇本 + 影響設置 -->
                <Grid Margin="0,8,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="所屬劇本" 
                               FontWeight="SemiBold" 
                               VerticalAlignment="Center"/>

                    <TextBox Grid.Column="2" 
                             x:Name="txtEdition" 
                             Text="custom"
                             Padding="6,4" 
                             BorderBrush="#CCC" 
                             BorderThickness="1" 
                             VerticalAlignment="Center"/>

                    <CheckBox Grid.Column="3" 
                              x:Name="chkSetup" 
                              Content="影響劇本設置" 
                              VerticalAlignment="Center" 
                              Margin="12,0,0,0"/>
                </Grid>

                <Border BorderBrush="#DDD" BorderThickness="0,0,0,1" Margin="0,8"/>

                <!-- 夜晚順序 + 提示 -->
                <Grid Margin="0,8,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 左側：首夜 -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="8"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <DockPanel Grid.Row="0">
                            <TextBlock Text="首夜順序" 
                                       FontWeight="SemiBold" 
                                       DockPanel.Dock="Left" 
                                       VerticalAlignment="Center" 
                                       Margin="0,0,8,0" 
                                       Width="70"/>
                            <TextBox x:Name="txtFirstNight" 
                                     Text="0"
                                     Padding="6,4" 
                                     BorderBrush="#CCC" 
                                     BorderThickness="1" 
                                     VerticalAlignment="Center"/>
                        </DockPanel>

                        <DockPanel Grid.Row="2">
                            <TextBlock Text="首夜提示" 
                                       FontWeight="SemiBold" 
                                       DockPanel.Dock="Left" 
                                       VerticalAlignment="Top" 
                                       Margin="0,4,8,0" 
                                       Width="70"/>
                            <TextBox x:Name="txtFirstNightReminder" 
                                     TextWrapping="Wrap" 
                                     AcceptsReturn="True" 
                                     Height="80"
                                     Padding="6,4" 
                                     BorderBrush="#CCC" 
                                     BorderThickness="1" 
                                     FontSize="11" 
                                     VerticalScrollBarVisibility="Auto"/>
                        </DockPanel>
                    </Grid>

                    <!-- 右側：其他夜 -->
                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="8"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <DockPanel Grid.Row="0">
                            <TextBlock Text="其他夜順序" 
                                       FontWeight="SemiBold" 
                                       DockPanel.Dock="Left" 
                                       VerticalAlignment="Center" 
                                       Margin="0,0,8,0" 
                                       Width="80"/>
                            <TextBox x:Name="txtOtherNight" 
                                     Text="0"
                                     Padding="6,4" 
                                     BorderBrush="#CCC" 
                                     BorderThickness="1" 
                                     VerticalAlignment="Center"/>
                        </DockPanel>

                        <DockPanel Grid.Row="2">
                            <TextBlock Text="其他夜提示" 
                                       FontWeight="SemiBold" 
                                       DockPanel.Dock="Left" 
                                       VerticalAlignment="Top" 
                                       Margin="0,4,8,0" 
                                       Width="80"/>
                            <TextBox x:Name="txtOtherNightReminder" 
                                     TextWrapping="Wrap" 
                                     AcceptsReturn="True" 
                                     Height="80"
                                     Padding="6,4" 
                                     BorderBrush="#CCC" 
                                     BorderThickness="1" 
                                     FontSize="11" 
                                     VerticalScrollBarVisibility="Auto"/>
                        </DockPanel>
                    </Grid>
                </Grid>

                <Border BorderBrush="#DDD" BorderThickness="0,0,0,1" Margin="0,8"/>

                <!-- 提示標記 -->
                <TextBlock Text="提示標記" FontWeight="SemiBold" Margin="0,8,0,8"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 左側：一般標記 -->
                    <StackPanel Grid.Column="0">
                        <TextBlock Text="一般標記" FontWeight="SemiBold" FontSize="12" Margin="0,0,0,4"/>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <Button Content="➕ 新增" Padding="6,3" FontSize="11"
            Click="ManageReminder_Click" Tag="Add|Normal"
            Background="#4CAF50" Foreground="White" BorderThickness="0" Margin="0,0,6,0"/>
                            <Button Content="🗑️ 刪除" Padding="6,3" FontSize="11"
            Click="ManageReminder_Click" Tag="Remove|Normal"
            Background="#F44336" Foreground="White" BorderThickness="0"/>
                        </StackPanel>

                        <Border BorderBrush="#DDD" BorderThickness="1" Height="100" Background="White">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <ItemsControl x:Name="remindersList">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="#EEE" BorderThickness="0,0,0,1" Padding="6,4" Background="White">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="6"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <CheckBox Grid.Column="0" 
                                                              IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                                              VerticalAlignment="Center"/>

                                                    <TextBox Grid.Column="2" 
                                                             Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}" 
                                                             BorderThickness="0" 
                                                             Background="Transparent"
                                                             Padding="4,2"
                                                             FontSize="11"
                                                             VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>
                    </StackPanel>

                    <!-- 右側：全局標記 -->
                    <StackPanel Grid.Column="2">
                        <TextBlock Text="全局標記" FontWeight="SemiBold" FontSize="12" Margin="0,0,0,4"/>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <Button Content="➕ 新增" Padding="6,3" FontSize="11"
            Click="ManageReminder_Click" Tag="Add|Global"
            Background="#4CAF50" Foreground="White" BorderThickness="0" Margin="0,0,6,0"/>
                            <Button Content="🗑️ 刪除" Padding="6,3" FontSize="11"
            Click="ManageReminder_Click" Tag="Remove|Global"
            Background="#F44336" Foreground="White" BorderThickness="0"/>
                        </StackPanel>

                        <Border BorderBrush="#DDD" BorderThickness="1" Height="100" Background="White">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <ItemsControl x:Name="globalRemindersList">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="#EEE" BorderThickness="0,0,0,1" Padding="6,4" Background="White">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="6"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <CheckBox Grid.Column="0" 
                                                              IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                                              VerticalAlignment="Center"/>

                                                    <TextBox Grid.Column="2" 
                                                             Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}" 
                                                             BorderThickness="0" 
                                                             Background="Transparent"
                                                             Padding="4,2"
                                                             FontSize="11"
                                                             VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>
                    </StackPanel>
                </Grid>

                <Border BorderBrush="#DDD" BorderThickness="0,0,0,1" Margin="0,10"/>

                <!-- 備註 -->
                <DockPanel Margin="0,8,0,0">
                    <TextBlock Text="備註" 
                               FontWeight="SemiBold" 
                               DockPanel.Dock="Left" 
                               VerticalAlignment="Top" 
                               Margin="0,4,8,0" 
                               Width="80"/>
                    <TextBox x:Name="txtFlavor" 
                             TextWrapping="Wrap" 
                             AcceptsReturn="True" 
                             Height="60"
                             Padding="6,4" 
                             BorderBrush="#CCC" 
                             BorderThickness="1" 
                             FontSize="11" 
                             VerticalScrollBarVisibility="Auto"/>
                </DockPanel>

            </StackPanel>
        </ScrollViewer>

        <!-- 底部按鈕 -->
        <Border Grid.Row="1" 
                Background="#F5F5F5" 
                Padding="20,15" 
                BorderBrush="#DDD" 
                BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button x:Name="btnSave"
                        Content="💾 儲存到資料庫" 
                        Width="120" 
                        Height="35"
                        Background="#4CAF50" 
                        Foreground="White"
                        BorderThickness="0"
                        FontWeight="SemiBold"
                        Margin="0,0,10,0"
                        Click="Save_Click"
                        IsEnabled="False"/>

                <Button Content="取消" 
                        Width="80" 
                        Height="35"
                        Click="Cancel_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>